<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mental Health Resources Allocation Dashboard</title>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
        }

        /* 1. Center the entire dashboard content */
        #main-container {
            max-width: 1400px;
            margin: 0 auto; /* Centers the whole container */
            padding: 20px;
        }

        /* Center the main title */
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
        }

        /* 2. Full-Width Top Controls Section */
        #top-full-width {
            margin-bottom: 30px;
        }

        /* Center the Year Selector Buttons group */
        #year-selector {
            display: flex; 
            gap: 10px;
            width: fit-content; /* Make container only as wide as content */
            margin: 0 auto 20px auto; /* Center the buttons horizontally */
        }
        #year-selector button {
            padding: 10px 20px;
            border: 1px solid #007bff;
            background-color: #ffffff;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 5px;
            font-weight: bold;
        }
        #year-selector button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        /* Styling for the new Interactive Panels */
        #summary-panels {
            display: flex;
            justify-content: center; /* Center the panels group */
            gap: 20px;
            max-width: 900px; /* Limits width of summary panels for clean look */
            margin: 0 auto; /* Center the panel group horizontally */
        }
        .data-panel {
            flex: 1;
            text-align: center;
            border: 1px solid #ddd;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        .data-panel h3 {
            margin: 0 0 5px 0;
            font-size: 0.9em;
            color: #555;
            text-transform: uppercase;
        }
        .data-panel .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #000000;
            display: block;
        }
        
        /* --- TOP ROW 50/50 LAYOUT (Controls + Gender Chart) --- */
        #top-row-split {
            display: flex;
            gap: 10px; /* Define the gap */
            width: 100%;
            margin-bottom: 30px; /* Space between the top row and the bottom charts */
        }

        #controls-panel, #gender-chart-panel {
            /* FIX: Use calc to achieve a mathematically precise 50% width 
               by subtracting half of the 10px gap. */
            flex-basis: calc(50% - 5px); 
            /* Lock the size and stretch height for vertical alignment */
            flex-grow: 0;
            flex-shrink: 0; 
            align-self: stretch; 
        }

        #controls-panel {
            min-width: 250px; 
            /* FIX 1: Change padding from 20px to 15px to match chart panels */
            padding: 15px; 
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        #gender-chart-panel {
            padding: 15px; 
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            flex-grow: 1; 
        }
        
        /* --- BOTTOM ROW 50/50 LAYOUT (Map + Welfare Chart) --- */
        #bottom-row-split {
            display: flex;
            gap: 10px; 
            width: 100%;
            /* No margin-bottom needed here unless we add a third row */
        }
        
        #accessibility-map-panel, #welfare-chart-panel {
            /* Use calc to achieve a mathematically precise 50% width */
            flex-basis: calc(50% - 5px); 
            flex-grow: 0;
            flex-shrink: 0; 
            
            padding: 15px; 
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }


        .graph-container {
            width: 100%; 
            /* Base styles for containers, now mostly inherited */
        }
        h2 {
            margin-top: 0;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        #citySelect {
            font-size: 1.2em; 
            padding: 8px;
            width: 100%; 
            border-radius: 5px;
        }
        .controls label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div id="main-container">
        <h1>MENTAL HEALTH RESOURCES ALLOCATION DASHBOARD</h1>

        <div id="top-full-width">
            
            <div id="year-selector">
                <button data-year="2020">2020</button>
                <button data-year="2021">2021</button>
                <button data-year="2022">2022</button>
                <button data-year="2023">2023</button>
                <button data-year="2024" class="active">2024</button>
            </div>

            <div id="summary-panels">
                <div class="data-panel">
                    <h3>High Risk High Resources</h3>
                    <span id="highRiskHighResourcesValue" class="value">--</span>
                </div>
                <div class="data-panel">
                    <h3>High Risk Low Resources</h3>
                    <span id="highRiskLowResourcesValue" class="value">--</span>
                </div>
                <div class="data-panel">
                    <h3>High Risk Generation</h3>
                    <span id="highRiskGenerationValue" class="value">--</span>
                </div>
            </div>
        </div>
        <div id="top-row-split">
            
            <div id="controls-panel">
                
                <div class="controls" style="margin-bottom: 20px;">
                    <label for="citySelect">Select City/County:</label>
                    <select id="citySelect" onchange="loadAllChartsForCity(this.value, this.options[this.selectedIndex].textContent)">
                        <option value="" disabled selected>Loading...</option>
                    </select>
                    <div id="error" style="color: red; margin-top: 10px;"></div>
                </div>

                <hr style="border-color:#eee; margin: 15px 0;"> 
                
               <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px;">
                        <label style="flex-shrink: 0; margin-right: 10px;">CENTER NUMBER:</label>
                        <span id="centerNumberDisplay" style="flex-grow: 1; padding: 5px; box-sizing: border-box; text-align: right;">--</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px;">
                        <label style="flex-shrink: 0; margin-right: 10px;">ONLINE CENTER NUMBER:</label>
                        <span id="onlineCenterNumberDisplay" style="flex-grow: 1; padding: 5px; box-sizing: border-box; text-align: right;">--</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px;">
                        <label style="flex-shrink: 0; margin-right: 10px;">POPULATION:</label>
                        <span id="populationDisplay" style="flex-grow: 1; padding: 5px; box-sizing: border-box; text-align: right;">--</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px;">
                        <label style="flex-shrink: 0; margin-right: 10px;">AREA:</label>
                        <span id="areaDisplay" style="flex-grow: 1; padding: 5px; box-sizing: border-box; text-align: right;">--</span>
                    </div>
                </div>
            </div>
            
            <div id="gender-chart-panel">
                <h2>Gender SMR Trend</h2>
                <div id="genderChart" style="width: 100%; height: 450px;"></div> 
            </div>
        </div>
        <div id="bottom-row-split">
            
            <div id="accessibility-map-panel">
                <h2>Service Accessibility Map</h2>
                <div id="accessibilityMapChart" style="width: 100%; height: 450px;"></div> 
            </div>

            <div id="welfare-chart-panel">
                <h2>Welfare Spending Trend</h2>
                <div id="welfareChart" style="width: 100%; height: 450px;"></div> 
            </div>
        </div>
        </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>